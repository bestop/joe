---
layout: post
published: true
title: 如何为Blogger添加相关文章
tags: 信息||Info    
permalink: /2009-08-15-如何为blogger添加相关文章.html
description:       从blogger后台进入"布局-修改HTML"。注意先check"扩展窗口小部件模板"，这样会显示完整的模板文件。     在&lt;/head&gt;前加入下面代码，其中加粗内容控制数量。     &lt;script&nbsp;type='text/javascript'&gt;//&lt;![CDA
summary: <DIV><FONT size=2>  <OL>    <LI>从blogger后台进入"布局-修改HTML"。注意先check"扩展窗口小部件模板"，这样会显示完整的模板文件。     <LI>在&lt;/head&gt;前加入下面代码，其中加粗内容控制数量。     <BLOCKQUOTE>&lt;script&nbsp;type='text/javascript'&gt;<BR>//&lt;![CDATA[<BR>&lt;!--&nbsp;Script&nbsp;functions&nbs
---
  <div class="post"><div><DIV><FONT size=2>  <OL>    <LI>从blogger后台进入"布局-修改HTML"。注意先check"扩展窗口小部件模板"，这样会显示完整的模板文件。     <LI>在&lt;/head&gt;前加入下面代码，其中加粗内容控制数量。     <BLOCKQUOTE>&lt;script&nbsp;type='text/javascript'&gt;<BR>//&lt;![CDATA[<BR>&lt;!--&nbsp;Script&nbsp;functions&nbsp;for&nbsp;Related&nbsp;Posts:&nbsp;RelatedLabels(),&nbsp;RemoveDuplicatedPosts(),&nbsp;contains(),&nbsp;ShowRelatedPosts()--&gt;<BR>var&nbsp;relatedPostsNum&nbsp;=&nbsp;0;<BR>var&nbsp;relatedTitles&nbsp;=&nbsp;new&nbsp;Array();<BR>var&nbsp;relatedUrls&nbsp;=&nbsp;new&nbsp;Array();<BR>var&nbsp;relatedDates&nbsp;=&nbsp;new&nbsp;Array();<BR><BR>function&nbsp;RelatedLabels(json)&nbsp;{<BR>&nbsp;&nbsp;var&nbsp;regex1=/&lt;/g,&nbsp;regex2=/&gt;/g;<BR>&nbsp;&nbsp;for&nbsp;(var&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;json.feed.entry.length;&nbsp;i++)&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;entry&nbsp;=&nbsp;json.feed.entry[i];<BR>&nbsp;&nbsp;&nbsp;&nbsp;relatedTitles[relatedPostsNum]&nbsp;=&nbsp;(entry.title.$t.replace(regex1,&nbsp;'&lt;')).replace(regex2,&nbsp;'&gt;');<BR>&nbsp;&nbsp;&nbsp;&nbsp;relatedDates[relatedPostsNum]&nbsp;=&nbsp;entry.published.$t.substr(0,10);<BR>&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(var&nbsp;j&nbsp;=&nbsp;0;&nbsp;j&nbsp;&lt;&nbsp;entry.link.length;&nbsp;j++)&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(entry.link[j].rel&nbsp;==&nbsp;'alternate')&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;relatedUrls[relatedPostsNum]&nbsp;=&nbsp;entry.link[j].href;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;relatedPostsNum++;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;}<BR>}<BR><BR>function&nbsp;RemoveDuplicatedPosts(PostUrl)&nbsp;{<BR>&nbsp;&nbsp;var&nbsp;tmpUrls&nbsp;=&nbsp;new&nbsp;Array(0);<BR>&nbsp;&nbsp;var&nbsp;tmpTitles&nbsp;=&nbsp;new&nbsp;Array(0);<BR>&nbsp;&nbsp;var&nbsp;tmpDates&nbsp;=&nbsp;new&nbsp;Array(0);<BR>&nbsp;&nbsp;function&nbsp;contains(a,&nbsp;e)&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;for(var&nbsp;j&nbsp;=&nbsp;0;&nbsp;j&nbsp;&lt;&nbsp;a.length;&nbsp;j++)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(a[j]==e)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;<BR>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;<BR>&nbsp;&nbsp;}<BR>&nbsp;&nbsp;for(var&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;relatedUrls.length;&nbsp;i++)&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;if(!contains(tmpUrls,&nbsp;relatedUrls[i])&nbsp;&amp;&amp;&nbsp;PostUrl&nbsp;!=&nbsp;relatedUrls[i])&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmpUrls.length&nbsp;+=&nbsp;1;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmpUrls[tmpUrls.length&nbsp;-&nbsp;1]&nbsp;=&nbsp;relatedUrls[i];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmpTitles.length&nbsp;+=&nbsp;1;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmpTitles[tmpTitles.length&nbsp;-&nbsp;1]&nbsp;=&nbsp;relatedTitles[i];<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmpDates.length&nbsp;+=&nbsp;1;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tmpDates[tmpDates.length&nbsp;-&nbsp;1]&nbsp;=&nbsp;relatedDates[i];<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;}<BR>&nbsp;&nbsp;relatedTitles&nbsp;=&nbsp;tmpTitles;<BR>&nbsp;&nbsp;relatedUrls&nbsp;=&nbsp;tmpUrls;<BR>&nbsp;&nbsp;relatedDates&nbsp;=&nbsp;tmpDates;<BR>}<BR><BR>function&nbsp;ShowRelatedPosts(PostUrl)&nbsp;{<BR>&nbsp;&nbsp;RemoveDuplicatedPosts(PostUrl);<BR>&nbsp;&nbsp;var&nbsp;r&nbsp;=&nbsp;Math.floor((relatedTitles.length&nbsp;-&nbsp;1)&nbsp;*&nbsp;Math.random());<BR>&nbsp;&nbsp;var&nbsp;i&nbsp;=&nbsp;0;<BR>&nbsp;&nbsp;if&nbsp;(relatedTitles.length&nbsp;&gt;&nbsp;0)&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;document.write('Related&nbsp;Posts:&nbsp;&lt;ul&gt;');<BR>&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(i&nbsp;&lt;&nbsp;relatedTitles.length&nbsp;<B>&amp;&amp;&nbsp;i&nbsp;&lt;&nbsp;5</B>)&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.write('&lt;li&gt;&lt;a&nbsp;href="'&nbsp;+&nbsp;relatedUrls[r]&nbsp;+&nbsp;'"&gt;'&nbsp;+&nbsp;relatedTitles[r]&nbsp;+&nbsp;'&lt;/a&gt;&nbsp;-&nbsp;'&nbsp;+&nbsp;relatedDates[r]&nbsp;+&nbsp;'&lt;/li&gt;');<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(r&nbsp;&lt;&nbsp;relatedTitles.length&nbsp;-&nbsp;1)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r++;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;=&nbsp;0;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i++;<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;document.write('&lt;/ul&gt;');<BR>&nbsp;&nbsp;}<BR>}<BR>//]]&gt;<BR>&lt;/script&gt;</BLOCKQUOTE>    <LI>找到下面代码：     <BLOCKQUOTE>&lt;b:if&nbsp;cond='data:post.labels'&gt;<BR>&lt;data:postLabelsLabel/&gt;<BR>&lt;b:loop&nbsp;values='data:post.labels'&nbsp;var='label'&gt;<BR>&lt;a&nbsp;expr:href='data:label.url'&nbsp;rel='tag'&gt;&lt;data:label.name/&gt;&lt;/a&gt;&lt;b:if&nbsp;cond='data:label.isLast&nbsp;!=&nbsp;"true"'&gt;,&lt;/b:if&gt;<BR>&lt;/b:loop&gt;<BR>&lt;/b:if&gt;</BLOCKQUOTE>在&lt;/b:loop&gt;前加入收集信息的调用，如下所示，其中加粗部分也是控制数量的：       <BLOCKQUOTE>&lt;b:if&nbsp;cond='data:post.labels'&gt;<BR>&lt;data:postLabelsLabel/&gt;<BR>&lt;b:loop&nbsp;values='data:post.labels'&nbsp;var='label'&gt;<BR>&lt;a&nbsp;expr:href='data:label.url'&nbsp;rel='tag'&gt;&lt;data:label.name/&gt;&lt;/a&gt;&lt;b:if&nbsp;cond='data:label.isLast&nbsp;!=&nbsp;"true"'&gt;,&lt;/b:if&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Fixed&nbsp;for&nbsp;Related&nbsp;Posts&nbsp;--&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;b:if&nbsp;cond='data:blog.pageType&nbsp;==&nbsp;"item"'&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;expr:src='"/feeds/posts/default/-/"&nbsp;+&nbsp;data:label.name&nbsp;+&nbsp;"?alt=json-in-script&amp;callback=RelatedLabels<B>&amp;max-results=10</B>"'&nbsp;type='text/javascript'/&gt;<BR>&lt;/b:if&gt;<BR>&lt;/b:loop&gt;<BR>&lt;/b:if&gt;</BLOCKQUOTE>    <LI>在&lt;div class='post-footer-line post-footer-line-3'/&gt;中加入显示部分，如下所示：     <BLOCKQUOTE>&lt;div&nbsp;class='post-footer-line&nbsp;post-footer-line-3'/&gt;<BR>&nbsp;&nbsp;&lt;b:if&nbsp;cond='data:blog.pageType&nbsp;==&nbsp;"item"'&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&nbsp;type='text/javascript'&gt;ShowRelatedPosts('&lt;data:post.url/&gt;');&lt;/script&gt;<BR>&nbsp;&nbsp;&lt;/b:if&gt;&nbsp;&lt;/div&gt;</BLOCKQUOTE></LI></OL></FONT></DIV></div>
   
    
    
      
    </p>
    
    </div>
